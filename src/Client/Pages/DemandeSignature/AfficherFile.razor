@using Grs.BioRestock.Transfer.DataModels.Document;
@using Microsoft.AspNetCore.SignalR.Client;
@inject IJSRuntime _JSRuntime;

<div>
    <iframe id="pdfViewer" src="" style="width:100%;height:640px;"></iframe>

    <MudMenuItem OnClick="@(() => OpenPDF(@IdFile))">Voir</MudMenuItem>
</div>

@code {
    [CascadingParameter] private MudDialogInstance MudDialog { get; set; }
    [CascadingParameter] private HubConnection HubConnection { get; set; }

    [Inject] private IDocumentClient _documentClient { get; set; }
    //[Inject] private IJSRuntime js;


    protected DocumentDto document { get; set; }

    protected List<DocumentDto> allDocument { get; set; } = new();

    [Parameter] public int IdFile { get; set; }


    protected override async Task OnInitializedAsync()
    {
        await GetAllDemande();
         OpenPDF(IdFile);
    }

    private async Task GetAllDemande()
    {
        try
        {
            var response = await _documentClient.GetAllGetAsync();
            if (response.Succeeded)
            {
                allDocument = response.Data.ToList();
            }
        }
        catch (Exception)
        {
            throw;
        }
    }

    public void OpenPDF(int IdFile)
    {
        var document = allDocument.FirstOrDefault(d => d.Id == IdFile);
        string filePath = document.FileUrl;
        ((IJSRuntime)_JSRuntime).InvokeAsync<object>("openPDF", filePath);
    }
}
